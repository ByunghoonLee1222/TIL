# SQL

### EXISTS

* ```sql
  내가 속한 각부서 별 월급 평균 이상으로 받는 직원들을 조회 하시오.
  단 부서 명과 지역을 출력 하시오.
  
  SELECT  e1.ENAME,e1.SAL,d.DEPTNO,d.LOC FROM EMP e1, DEPT d
  WHERE e1.DEPTNO = d.DEPTNO
  AND e1.SAL >= (
  SELECT MAX(SAL) FROM EMP e2
  WHERE e1.DEPTNO = e2.DEPTNO
  GROUP BY DEPTNO
  )
  
  scott이 소속된 부서의 직원 정보를 조회 하시오.
  
  SELECT  e1.ENAME,e1.SAL,d.DEPTNO,d.LOC FROM EMP e1, DEPT d
  WHERE e1.DEPTNO = d.DEPTNO
  AND e1.DEPTNO IN (
  SELECT DEPTNO FROM EMP
  WHERE ENAME ='SCOTT'
  )
  
  DALLAS에 있는 직원의 정보를 조회하시오.
  
  SELECT  e1.ENAME,e1.SAL,d.DEPTNO,d.LOC FROM EMP e1, DEPT d
  WHERE e1.DEPTNO = d.DEPTNO
  AND e1.DEPTNO IN (
  SELECT DEPTNO FROM DEPT
  WHERE LOC ='DALLAS'
  )
  
  
  SELECT  e1.ENAME,e1.SAL,d.DEPTNO,d.LOC FROM EMP e1, DEPT d
  WHERE e1.DEPTNO = d.DEPTNO
  AND EXISTS (
  SELECT d2.DEPTNO FROM DEPT d2, EMP e2
  WHERE d2.DEPTNO = e2.DEPTNO
  AND LOC ='DALLAS'
  AND e1.DEPTNO = e2.DEPTNO
  )
  
  JONES가 속한 JOB의 직원을 조회 하시오.
  단, 직원의 부서명과 지역을 출력 하시오.
  
  SELECT e1.ENAME,e1.JOB,d.DNAME,d.LOC FROM EMP e1, DEPT d
  WHERE e1.DEPTNO = D.DEPTNO
  AND EXISTS(
  SELECT JOB FROM EMP e2
  WHERE ENAME = 'JONES'
  AND e1.JOB = e2.JOB
  )
  
  ```

### UNION

* ```sql
  MANAGER와 SALES 직원들의 이름과 JOB을 조회 하시오
  
  SELECT ENAME, JOB FROM EMP
  WHERE JOB = 'MANAGER'
  UNION
  SELECT ENAME, TO_CHAR(HIREDATE,'YYYY/MM/DD') FROM EMP
  WHERE JOB='SALESMAN'
  ORDER BY JOB
  
  ```

### INNER JOIN

* ```sql
  CREATE VIEW T_EMP(ENO,ENM,SAL,DNO)
  AS
  SELECT EMPNO, ENAME, SAL, DEPTNO FROM EMP
  
  
  CREATE VIEW T_DEPT(DNO,DNM,LOC)
  AS
  SELECT DEPTNO, DNAME, LOC FROM DEPT
  
  
  CREATE VIEW T_SAL (ENO,ASAL)
  AS
  SELECT EMPNO, (SAL*12) + (NVL(COMM,0)*12)
  FROM EMP
  
  직원 정보를 조회 하시오.
  ENO, ENM, SAL, ASAL, DNM, LOC
  
  SELECT e.ENO, e.ENM,e.SAL, a.ASAL, d.DNM, d.LOC FROM T_SAL a, T_EMP e, T_DEPT d
  WHERE e.DNO = d.DNO
  AND e.ENO = a.ENO
  
  SELECT e.ENO,e.ENM,e.SAL,a.ASAL,d.DNM,d.LOC
  FROM 
  T_EMP e INNER JOIN T_DEPT d ON( e.DNO = d.DNO)
  INNER JOIN T_SAL a ON (e.ENO = a.ENO)
  
  
  ENO, ENM, SAL, ASAL, DNM, LOC
  JONES 부서원만 조회 하시오.
  
  SELECT e.ENO, e.ENM,e.SAL, a.ASAL, d.DNM, d.LOC FROM T_SAL a, T_EMP e, T_DEPT d
  WHERE e.DNO = d.DNO
  AND e.ENO = a.ENO
  AND e.DNO IN(SELECT DNO FROM T_EMP WHERE ENM = 'JONES')
  
  ENO, ENM, SAL, ASAL, DNM, LOC 정보 조회
  부서별 연봉의 평균 보다 많이 받는 직원을 조회
  
  SELECT e.ENO, e.ENM,e.SAL, a.ASAL, d.DNM, d.LOC FROM T_SAL a, T_EMP e, T_DEPT d
  WHERE e.DNO = d.DNO
  AND e.ENO = a.ENO
  AND a.ASAL >= (
  SELECT AVG(s1.ASAL) 
  FROM T_EMP e1,T_SAL s1
  WHERE e1.ENO = s1.ENO
  AND e.DNO= e1.DNO
  GROUP BY (e1.DNO)
  )
  
  
  ```

* 

* **USING**

  ```sql
  SELECT E.NAME, D.LOC FROM EMP E 
  INNER JOIN DEPT D
  USING(DEPTNO)
  ```

* ```sql
  직원의 정보를 출력 하시오.
  EMPNO, ENAME, MNAME 을 출력 하시오.
  SELF JOIN
  
  SELECT E1.EMPNO AS EMPNO,
         E1.ENAME AS ENMAE,
         e2.ENAME AS MNAME
  FROM EMP E1, EMP e2
  WHERE E1.MGR = e2.EMPNO
  ```

### OUTER JOIN

* ```sql
  SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
  FROM EMP e, DEPT d
  WHERE e.DEPTNO = d.DEPTNO(+)
  -- +쪽의 반대쪽에 없는것들이 나온다.
  ```

* ```sql
  -- 매칭이 안되는 값들 출력
  SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
  FROM EMP e LEFT OUTER JOIN DEPT d
  USING(DEPTNO)
  -- EMP e 기준
  SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
  FROM EMP e RIGHT OUTER JOIN DEPT d
  USING(DEPTNO)
  --DEPT d 기준
  SELECT e.ENAME,e.JOB,d.DNAME,d.LOC
  FROM EMP e FULL OUTER JOIN DEPT d
  USING(DEPTNO)
  --양쪽다 출력
  ```

### RANK

* ```sql
  -- 동률 제외 (EX. 1,2,3,3,5)
  SELECT ENAME, SAL, 
  RANK() OVER(ORDER BY SAL DESC) AS RANKING
  FROM EMP
  ORDER BY SAL DESC
  
  -- 동률 포함(EX. 1,2,3,3,4,5)
  SELECT ENAME, SAL, 
  RANK() OVER(ORDER BY SAL DESC) AS RANKING,
  DENSE_RANK() OVER(ORDER BY SAL DESC) AS D_RANKING
  FROM EMP
  ORDER BY SAL DESC
  ```

### ROW_NUMBER

* ```sql
  ROW_NUMBER() OVER (ORDER BY SAL DESC) AS ROW_NUM
  ```

*  순서대로 출력 ,값 같아도 출력 순서에 맞게 NUMBERING

* ```sql
  SELECT ENAME,SAL ,RANK,
  ROUND((SELECT AVG(SAL) FROM EMP),2) AS ASAL,
  (SELECT COUNT(*) FROM EMP) AS TOTAL
   FROM(
     SELECT ENAME, SAL,
     RANK() OVER (ORDER BY SAL DESC) AS RANK
     FROM EMP
  )
  WHERE RANK <= 5
   
  ```

  ### ROLL UP

* ```sql
  SELECT JOB, SUM(SAL)FROM EMP
  GROUP BY ROLLUP(JOB)
  --총합 하단 출력
  ```

* ```sql
  SELECT e.EMPNO,e.ENAME,e.JOB,e.MGR,e.HIREDATE,e.SAL,e.COMM,e.DEPTNO 
  FROM EMP e
  WHERE e.EMPNO = (SELECT e3.MGR FROM EMP e3
  GROUP BY e3.MGR 
  HAVING AVG(e3.SAL) = 
  (SELECT MAX(AVG(e1.SAL)) 
  FROM EMP e1,EMP e2
  WHERE e1.MGR = e2.EMPNO
  GROUP BY e1.MGR ))
  ```

  